#!/usr/bin/env bash
set -euo pipefail

# Initialize mise if available (for Elixir/mix).
if command -v mise >/dev/null 2>&1; then
  eval "$(mise activate bash)"
elif [ -f "$HOME/.local/bin/mise" ]; then
  eval "$("$HOME/.local/bin/mise" activate bash)"
fi

staged_files=()
while IFS= read -r file; do
  case "$file" in
    *.ex|*.exs) staged_files+=("$file") ;;
  esac
done < <(git diff --cached --name-only --diff-filter=ACM)

if [ "${#staged_files[@]}" -eq 0 ]; then
  exit 0
fi

echo "Formatting staged Elixir files..."
mix format "${staged_files[@]}"
git add "${staged_files[@]}"
